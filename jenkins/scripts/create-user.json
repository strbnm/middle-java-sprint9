{
  "name": "create_user",
  "type": "groovy",
  "content": "import groovy.json.JsonSlurper\n\ndef request = new JsonSlurper().parseText(args);\nassert request.adminPassword: 'adminPassword parameter is required';\nassert request.jenkinsPassword: 'jenkinsPassword parameter is required';\n\n\nsecurity.setAnonymousAccess(false)\nlog.info('Anonymous access disabled')\n//\n// Create new admin user\n//\ndef adminRole = ['nx-admin']\ndef janeDoe = security.addUser('ci_admin', 'CI', 'Administrator', 'ci_admin@example.com', true, request.adminPassword, adminRole)\nlog.info('User ci_admin created')\n\n//\n// Create a new role that allows a user same access as anonymous and adds healtchcheck access\n//\ndef devPrivileges = ['nx-healthcheck-read', 'nx-healthcheck-summary-read']\ndef anoRole = ['nx-anonymous']\n// add roles that uses the built in nx-anonymous role as a basis and adds more privileges\nsecurity.addRole('developer', 'Developer', 'User with privileges to allow read access to repo content and healtcheck', devPrivileges, anoRole)\nlog.info('Role developer created')\n//\n// Create new role that allows deployment and create a user to be used on a CI server\n//\n// privileges with pattern * to allow any format, browse and read are already part of nx-anonymous\ndef depPrivileges = ['nx-repository-view-*-*-add', 'nx-repository-view-*-*-edit']\ndef roles = ['developer']\n// add roles that uses the developer role as a basis and adds more privileges\nsecurity.addRole('deployer', 'Deployer', 'User with privileges to allow deployment all repositories', depPrivileges, roles)\nlog.info('Role deployer created')\ndef depRoles = ['deployer']\ndef lJenkins = security.addUser('jenkins', 'Leeroy', 'Jenkins', 'leeroy.jenkins@example.com', true, request.jenkinsPassword, depRoles)\nlog.info('User jenkins created')\n\n\nlog.info('Script security completed successfully')"
}